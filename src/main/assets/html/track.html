<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
        html, body, #map-canvas {
        margin: 0;
        padding: 0;
        height: 100%;
        }
        #panel {
        position: absolute;
        top: 5px;
        left: 50%;
        margin-left: -180px;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
        }
        img[src*="gstatic.com/"], img[src*="googleapis.com/"] {
        max-width: none;
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script>

var map;
var parts;

var colors =
[
    [ 5, '#800000' ],
    [ 10, '#C00000' ],
    [ 20, '#C04000' ],
    [ 30, '#C08000' ],
    [ 40, '#40A000' ],
    [ 60, '#00A000' ],
    [ 90, '#00A020' ],
    [  0, '#00A040' ]
];

function initialize() {
//    var track_data = android.getTrack();
    var track_data = '60.010216,30.244386,<b>08:25</b><br/><p dir="ltr">&#1087;&#1088;&#1086;&#1089;&#1087;&#1077;&#1082;&#1090; &#1040;&#1074;&#1080;&#1072;&#1082;&#1086;&#1085;&#1089;&#1090;&#1088;&#1091;&#1082;&#1090;&#1086;&#1088;&#1086;&#1074;&#x2C; 4 &#1082;&#1086;&#1088;&#1087;&#1091;&#1089; 2</p>' +
'|60.010216,30.244386,7.0,1380169544093|60.010353,30.244431,14.0,1380169547703|60.010414,30.244494,11.0,1380169549703|60.01054,30.24426,9.0,1380169554703|60.010658,30.244116,11.0,1380169557703|60.010781,30.243766,7.0,1380169562703|60.010808,30.243745,6.0,1380169564703|60.010913,30.243855,7.0,1380169573053|60.010971,30.243981,9.0,1380169576053|60.011031,30.244166,10.0,1380169578053|60.011183,30.244745,7.0,1380169586053|60.011181,30.244791,7.0,1380169587053|60.01128,30.24486,0.0,1380169597053|60.011418,30.244835,0.0,1380169642670|60.01137,30.244866,0.0,1380169648670|60.01123,30.244874,11.0,1380169659167|60.011111,30.245036,32.0,1380169661167|60.010411,30.24609,6.0,1380169703190|60.010351,30.246163,11.0,1380169705190|60.010133,30.246496,11.0,1380169724190|60.009398,30.247431,9.0,1380169784690|60.009341,30.247513,7.0,1380169788153|60.009314,30.247518,10.0,1380169789153|60.009285,30.247536,12.0,1380169790153|60.009253,30.247586,13.0,1380169791153|60.008696,30.247994,37.0,1380169799153|60.008464,30.24809,43.0,1380169801153|60.008231,30.248086,44.0,1380169803153|60.008113,30.248053,48.0,1380169805153|60.007291,30.247678,51.0,1380169811150|60.006178,30.247128,9.0,1380169839387|60.006156,30.247128,7.0,1380169840387|60.00607,30.24722,7.0,1380169862387|60.006028,30.247331,17.0,1380169865067|60.005976,30.247548,28.0,1380169867067|60.005949,30.247695,31.0,1380169869067|60.005665,30.250066,50.0,1380169879067|60.005526,30.251321,47.0,1380169884067|60.00542,30.252489,47.0,1380169889067|60.005385,30.253025,54.0,1380169891067|60.005226,30.253898,62.0,1380169894580|60.004786,30.256976,7.0,1380169907580|60.004758,30.256978,0.0,1380169913580|60.004758,30.256985,7.0,1380169926260|60.004745,30.257083,11.0,1380169928260|60.004723,30.257183,9.0,1380169930260|60.004703,30.257218,10.0,1380169931260|60.004671,30.257233,13.0,1380169932260|60.004626,30.257226,21.0,1380169933260|60.00329,30.256565,58.0,1380169945260|60.001818,30.25587,0.0,1380169966190|60.001805,30.255856,10.0,1380169981073|60.001713,30.255815,15.0,1380169984073|60.001298,30.255598,9.0,1380170006640|60.001263,30.255606,17.0,1380170007640|60.001211,30.255631,20.0,1380170008640|60.001158,30.255686,22.0,1380170009640|60.001118,30.255785,26.0,1380170010640|60.001084,30.25591,30.0,1380170011640|60.001024,30.256306,48.0,1380170013640|60.000918,30.25723,65.0,1380170016640|60.000779,30.25873,52.0,1380170023703|60.000281,30.262838,6.0,1380170056083|60.000276,30.262898,17.0,1380170057083|59.9994,30.269788,6.0,1380170091777|59.999354,30.270149,23.0,1380170095777|59.999338,30.270268,23.0,1380170096777|59.999321,30.270398,25.0,1380170097777|59.998795,30.274101,65.0,1380170115217|59.998471,30.276446,30.0,1380170124217|59.998471,30.276446,30.0,1380170125217|59.998356,30.276576,30.0,1380170126217|59.998281,30.276608,33.0,1380170128217|59.99781,30.276791,60.0,1380170132330|59.996366,30.277346,21.0,1380170143330|59.996331,30.277436,24.0,1380170144330|59.996311,30.277558,26.0,1380170145330|59.996305,30.277711,34.0,1380170146330|59.996321,30.277924,44.0,1380170147330|59.996386,30.279076,60.0,1380170151330|59.996605,30.283243,26.0,1380170167330|59.996605,30.28335,17.0,1380170168330|59.996596,30.283458,6.0,1380170170330|59.99659,30.283599,13.0,1380170179270|59.996638,30.284031,40.0,1380170182270|59.997053,30.293573,27.0,1380170232270|59.997029,30.294083,15.0,1380170236270|59.996996,30.294863,26.0,1380170244270|59.997029,30.295329,32.0,1380170247270|59.997081,30.296283,25.0,1380170253270|59.997091,30.29688,26.0,1380170258270|59.997266,30.299223,5.0,1380170275270|59.997293,30.299611,0.0,1380170301270|59.99728,30.299635,12.0,1380170305270|59.997243,30.299671,20.0,1380170306270|59.996846,30.299864,59.0,1380170310270|59.996511,30.300023,72.0,1380170312307|59.99633,30.300103,72.0,1380170313307|59.995963,30.300189,72.0,1380170315307|59.995591,30.300143,70.0,1380170317307|59.994346,30.299681,75.0,1380170324307|59.99243,30.298955,73.0,1380170334307|59.992088,30.298836,60.0,1380170336307|59.991643,30.298671,5.0,1380170364557|59.99114,30.298453,0.0,1380170418113|59.99112,30.29845,0.0,1380170473457|59.99112,30.298451,0.0,1380170523410|59.99112,30.29845,0.0,1380170587710|59.990725,30.298308,0.0,1380170621567|59.99053,30.298246,7.0,1380170713990|59.990405,30.298321,0.0,1380170755210|59.990408,30.298348,15.0,1380170798340|59.990368,30.298498,16.0,1380170800417|59.990346,30.298603,6.0,1380170801417|59.990224,30.298898,9.0,1380170894137|59.990168,30.299066,19.0,1380170896897|59.990044,30.299458,19.0,1380170899897|59.989849,30.299835,0.0,1380170967013|59.989893,30.299864,8.0,1380171032090|59.989873,30.299925,17.0,1380171033090|59.989781,30.300158,11.0,1380171036770|59.989803,30.300348,0.0,1380171076717|59.989818,30.300236,0.0,1380171133070|59.989551,30.300683,19.0,1380171149630|59.989523,30.300768,18.0,1380171150630|59.98951,30.300858,17.0,1380171151630|59.989549,30.301081,29.0,1380171153630|59.990156,30.303175,43.0,1380171163857|59.990618,30.304955,30.0,1380171173857|59.99079,30.305373,15.0,1380171177857|59.990811,30.305476,7.0,1380171179857|59.990878,30.305613,8.0,1380171191727|59.990985,30.306031,16.0,1380171196727|59.990998,30.306148,19.0,1380171197727|59.990986,30.306253,22.0,1380171198727|59.990883,30.306426,30.0,1380171200727|59.990148,30.307529,0.0,1380171235333|59.990093,30.307664,6.0,1380171258180|59.990065,30.307701,9.0,1380171259180|59.989923,30.307803,21.0,1380171261180|59.989751,30.308103,16.0,1380171266180|59.989536,30.30836,6.0,1380171272673|59.989338,30.308579,0.0,1380171303673|59.989331,30.308573,0.0,1380171321837|59.989291,30.308583,8.0,1380171326837|59.988943,30.309033,11.0,1380171336963|59.988851,30.309178,14.0,1380171339963|59.988541,30.30957,30.0,1380171346963|59.988423,30.309823,38.0,1380171348963|59.988369,30.310001,41.0,1380171349963|59.988329,30.3102,43.0,1380171350963|59.987965,30.312856,35.0,1380171363463|59.987911,30.313015,35.0,1380171364463|59.987855,30.313448,9.0,1380171380463|59.987818,30.313515,15.0,1380171381463|59.987743,30.31373,19.0,1380171384463|59.987628,30.314306,35.0,1380171388463|59.987085,30.317545,40.0,1380171402597|59.986979,30.31817,21.0,1380171405597|59.986948,30.318444,9.0,1380171409597|59.986936,30.318585,9.0,1380171412597|59.986911,30.318673,10.0,1380171414597|59.986908,30.318741,13.0,1380171415597|59.986889,30.318793,10.0,1380171416597|59.986836,30.318933,6.0,1380171419597|59.986836,30.318963,6.0,1380171420597|59.986816,30.319046,7.0,1380171430690|59.986799,30.319153,12.0,1380171432690|59.986725,30.319551,6.0,1380171438690|59.986745,30.320085,8.0,1380171464760|59.986746,30.320416,7.0,1380171507200|59.986666,30.320811,6.0,1380171517140|59.986509,30.321433,3.0,1380171533777|59.986426,30.321813,8.0,1380171563507|59.986413,30.321985,6.0,1380171568507|59.986416,30.322025,6.0,1380171570507|59.986371,30.322338,6.0,1380171591640|59.986356,30.32242,8.0,1380171593640|59.98622,30.322955,6.0,1380171611870|59.986144,30.32325,9.0,1380171617870|59.986025,30.32391,12.0,1380171627870|59.985941,30.32458,10.0,1380171640937|59.98596,30.324821,5.0,1380171664940|59.985928,30.325056,6.0,1380171673940|59.985923,30.32519,3.0,1380171680940|59.985701,30.326746,9.0,1380171707853|59.985658,30.327073,6.0,1380171713853|59.98565,30.327135,6.0,1380171714853|59.98563,30.327211,8.0,1380171722457|59.985585,30.327503,6.0,1380171728457|59.985563,30.327623,0.0,1380171736457|59.985559,30.327704,6.0,1380171743457|59.985564,30.327783,6.0,1380171746697|59.985556,30.327834,6.0,1380171748697|59.985463,30.328065,6.0,1380171770907|59.985448,30.328131,6.0,1380171772907|59.98545,30.328346,6.0,1380171781907|59.985421,30.328486,7.0,1380171786907|59.985413,30.328525,10.0,1380171787907|59.985381,30.328633,11.0,1380171789907|59.985165,30.328835,0.0,1380171826390|59.985063,30.329273,6.0,1380171859437|59.984993,30.329884,6.0,1380171878527|59.98499,30.329918,6.0,1380171879527|59.984936,30.330178,11.0,1380171888937|59.984933,30.330368,0.0,1380171912937|59.984911,30.330466,15.0,1380171934020|59.984861,30.330688,14.0,1380171937020|59.98452,30.332276,6.0,1380172027327|59.984514,30.33234,11.0,1380172028327|59.984501,30.332388,13.0,1380172028840|59.98442,30.332788,20.0,1380172031840|59.98437,30.333133,12.0,1380172036840|59.984346,30.333165,15.0,1380172037840|59.984316,30.33318,17.0,1380172038840|59.984275,30.333203,17.0,1380172039840|59.984,30.333306,9.0,1380172048840|59.983946,30.333309,10.0,1380172050840|59.98392,30.333303,12.0,1380172051840|59.98389,30.333273,18.0,1380172052840|59.983845,30.333213,24.0,1380172053840|59.983786,30.333126,29.0,1380172054840|59.981653,30.328446,6.0,1380172111667|59.98164,30.328433,23.0,1380172112667|59.981278,30.327471,59.0,1380172116477|59.981166,30.327201,67.0,1380172117477|59.98089,30.326593,81.0,1380172119477|59.980743,30.32624,87.0,1380172120477|59.980435,30.325491,93.0,1380172122477|59.979486,30.323488,82.0,1380172128477|59.97923,30.322981,68.0,1380172130477|59.978805,30.322128,58.0,1380172134477|59.978285,30.321119,16.0,1380172150477|59.978181,30.32091,24.0,1380172153477|59.977948,30.320431,6.0,1380172175497|59.977811,30.320191,14.0,1380172180497|59.977638,30.319896,6.0,1380172193057|59.977468,30.319586,13.0,1380172203057|59.977045,30.318806,13.0,1380172226057|59.976906,30.318648,11.0,1380172231897|59.976845,30.318555,9.0,1380172234897|59.976736,30.318435,7.0,1380172239897|59.976719,30.318376,7.0,1380172248897|59.97636,30.317926,10.0,1380172269037|59.976246,30.317821,9.0,1380172275037|59.976231,30.317789,9.0,1380172276037|59.976211,30.317683,8.0,1380172279287|59.976206,30.317639,8.0,1380172280287|59.976205,30.31759,9.0,1380172281287|59.976206,30.317545,8.0,1380172282287|59.976213,30.317501,8.0,1380172283287|59.97622,30.317461,7.0,1380172285287|59.976286,30.317391,10.0,1380172294287|59.976536,30.317556,17.0,1380172297287|59.977358,30.318568,26.0,1380172311433|59.977728,30.318973,33.0,1380172316433|59.977781,30.3191,31.0,1380172317433|59.977803,30.319238,26.0,1380172318433|59.977785,30.319383,26.0,1380172319433|59.977754,30.319521,29.0,1380172320433|59.977483,30.320231,53.0,1380172324433|59.977164,30.320953,57.0,1380172327433|59.976764,30.321911,24.0,1380172331847|59.976719,30.321976,23.0,1380172332847|59.976666,30.322031,22.0,1380172333847|59.976608,30.322033,23.0,1380172334847|59.976546,30.322003,25.0,1380172335847|59.974858,30.321219,24.0,1380172349847|59.974819,30.321286,18.0,1380172350847|59.974788,30.321376,23.0,1380172351847|59.974328,30.322709,15.0,1380172361847|59.974333,30.322773,11.0,1380172362847|59.974358,30.322895,7.0,1380172365847|59.974493,30.323181,7.0,1380172374847|59.974848,30.322483,18.0,1380172382847|59.974893,30.322298,7.0,1380172386887|59.974971,30.32221,9.0,1380172389887|59.975011,30.322166,9.0,1380172390887|59.975166,30.32214,17.0,1380172393887|59.975251,30.322113,15.0,1380172395887|59.975334,30.322131,16.0,1380172397887|59.97548,30.322221,11.0,1380172401887|59.975641,30.32249,9.0,1380172409887|59.975691,30.322553,6.0,1380172411887|59.975806,30.322561,8.0,1380172420887|59.975826,30.322583,9.0,1380172421887|59.975826,30.322583,9.0,1380172430887|59.975826,30.322583,9.0,1380172439887|59.975826,30.322583,<b>09:13</b><br/><p dir="ltr">&#1040;&#1087;&#1090;&#1077;&#1082;&#1072;&#1088;&#1089;&#1082;&#1080;&#1081; &#1087;&#1088;&#1086;&#1089;&#1087;&#1077;&#1082;&#1090;&#x2C; 11</p>';


    var min_lat = 180;
    var max_lat = -180;
    var min_lon = 180;
    var max_lon = -180;

    parts = (track_data+"").split('|');
    var points = [];
    var markers = [];

    for (var i in parts){
        var p = parts[i].split(',');
        var lat = parseFloat(p[0]);
        var lon = parseFloat(p[1]);
        if (lat < min_lat)
            min_lat = lat;
        if (lat > max_lat)
            max_lat = lat;
        if (lon < min_lon)
            min_lon = lon;
        if (lon > max_lon)
            max_lon = lon;
        if (p.length == 4){
            var speed = parseFloat(p[2]);
            for (var index = 0; index < colors.length - 1; index++){
                if (colors[index][0] >= speed)
                    break;
            }
            var point = new google.maps.LatLng(lat, lon);
            if (points.length){
                var last = points[points.length - 1];
                last.points.push(point);
                if (last.index == index)
                    index = -1;
            }
            if (index >= 0){
                var last = {
                    index:  index,
                    points: [ point ]
                }
                points.push(last);
            }
        }else{
            markers.push(p);
        }
    }

    var lat = (min_lat + max_lat) / 2;
    var lon = (min_lon + max_lon) / 2;

    var mapOptions = {
        zoom: 18,
        center: new google.maps.LatLng(lat, lon),
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        streetViewControl: false,
        mapTypeControl: false
    };

    map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
    var bounds = new google.maps.LatLngBounds(new google.maps.LatLng(min_lat, min_lon), new google.maps.LatLng(max_lat, max_lon));
    map.fitBounds(bounds);

    for (var i in markers){
        (function(i){
            var p = markers[i];
            var lat = parseFloat(p[0]);
            var lon = parseFloat(p[1]);
            var mark = new google.maps.Marker({
                position: new google.maps.LatLng(lat, lon),
                map: map
            });
            google.maps.event.addListener(mark, 'click', function(){
                var info = new google.maps.InfoWindow({
                    content: p[2]
                });
                info.open(map, mark);
            });
        })(i);
    }
    for (var i in points){
        var p = points[i];
        var track = new google.maps.Polyline({
            path: p.points,
            strokeColor: colors[p.index][1],
            strokeOpacity: 1.0,
            strokeWeight: 3,
            geodesic: true
        });
        track.setMap(map);
        google.maps.event.addListener(track, 'click', showPointInfo);
    }
}

var point_info = null;

function showPointInfo(event) {
    if (point_info != null){
        point_info.close();
        point_info = null;
    }
    var delta = 1000;
    var best_index = null;
    for (var i in parts){
        var p = parts[i].split(',');
        if (p.length != 4)
            continue;
        var lat = parseFloat(p[0]);
        var lon = parseFloat(p[1]);
        var d = Math.abs(lat - event.latLng.lat()) + Math.abs(lon - event.latLng.lng());
        if (d < delta){
            best_index = i;
            delta = d;
        }
    }
    if (best_index == null)
        return;
    var p = parts[best_index].split(',');
    var d = new Date(parseInt(p[3]));
    var lat = parseFloat(p[0]);
    var lon = parseFloat(p[1]);
    point_info = new google.maps.InfoWindow({
        content: d.toLocaleTimeString() + '<br/>' + p[2] + ' км/ч'
    });
    point_info.open(map);
    point_info.setPosition(new google.maps.LatLng(lat, lon));
}

function saveTrack() {
    var bounds = map.getBounds();
    var ne = bounds.getNorthEast();
    var sw = bounds.getSouthWest();
    android.save(sw.lat(), ne.lat(), sw.lng(), ne.lng());
}

function shareTrack() {
    var bounds = map.getBounds();
    var ne = bounds.getNorthEast();
    var sw = bounds.getSouthWest();
    android.share(sw.lat(), ne.lat(), sw.lng(), ne.lng());
}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
</head>
<body>
<div id="map-canvas"></div>
</body>
</html>