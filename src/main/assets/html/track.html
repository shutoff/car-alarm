<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
        html, body, #map-canvas {
        margin: 0;
        padding: 0;
        height: 100%;
        }
        #panel {
        position: absolute;
        top: 5px;
        left: 50%;
        margin-left: -180px;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script>

var map;
var start;
var finish;
var track;

function initialize() {
    var track_data =  android.getTrack();

    var min_lat = 180;
    var max_lat = -180;
    var min_lon = 180;
    var max_lon = -180;

    var points = track_data.split('|');
    for (var i in points){
        var p = points[i].split(',');
        var lat = parseFloat(p[0]);
        var lon = parseFloat(p[1]);
        if (lat < min_lat)
            min_lat = lat;
        if (lat > max_lat)
            max_lat = lat;
        if (lon < min_lon)
            min_lon = lon;
        if (lon > max_lon)
            max_lon = lon;
        points[i] = new google.maps.LatLng(lat, lon);
    }

    var lat = (min_lat + max_lat) / 2;
    var lon = (min_lon + max_lon) / 2;

    var mapOptions = {
        zoom: 18,
        center: new google.maps.LatLng(lat, lon),
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        streetViewControl: false,
        mapTypeControl: false
    };
    map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
    var bounds = new google.maps.LatLngBounds(new google.maps.LatLng(min_lat, min_lon), new google.maps.LatLng(max_lat, max_lon));
    map.fitBounds(bounds);
    start = new google.maps.Marker({
      position: points[0],
      map: map
    });
    finish = new google.maps.Marker({
      position: points[points.length - 1],
      map: map
    });
    track = new google.maps.Polyline({
        path: points,
        strokeColor: '#000080',
        strokeOpacity: 1.0,
        strokeWeight: 2
    });
    track.setMap(map);
}

function saveTrack() {
    var bounds = map.getBounds();
    var ne = bounds.getNorthEast();
    var sw = bounds.getSouthWest();
    android.save(sw.lat(), ne.lat(), sw.lng(), ne.lng());
}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>
</head>
<body>
<div id="map-canvas"></div>
</body>
</html>